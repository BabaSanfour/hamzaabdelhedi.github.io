{% assign c = "c-news-card" %}
{% assign direct_url = include.post.external_url | default: include.post.link_url %}
{% if direct_url %}
  {% assign target_url = direct_url %}
  {% assign is_external = true %}
{% elsif include.post.url %}
  {% assign target_url = include.post.url | relative_url %}
  {% assign is_external = false %}
{% endif %}
{% assign has_media = include.post.image %}

<article class="{{c}}">
  <div class="{{c}}__inner{% unless has_media %} {{c}}__inner--compact{% endunless %}">
    {% if has_media %}
      {% if target_url %}
      <a class="{{c}}__media" href="{{ target_url }}"{% if is_external %} target="_blank" rel="noopener noreferrer"{% endif %}>
        <img loading="lazy" src="{{ include.post.image }}" alt="{{ include.post.title }}">
      </a>
      {% else %}
      <div class="{{c}}__media">
        <img loading="lazy" src="{{ include.post.image }}" alt="{{ include.post.title }}">
      </div>
      {% endif %}
    {% endif %}

    <div class="{{c}}__content">
      {% if include.post.tags and include.post.tags.size >= 1 %}
      <div class="{{c}}__tags">
        {% for tag in include.post.tags %}
        <a href="{{ '/tag/' | append: tag | downcase | relative_url }}" class="{{c}}__tag">{{ tag }}</a>
        {% endfor %}
      </div>
      {% endif %}

      <h3 class="{{c}}__title">
        {% if target_url %}
        <a href="{{ target_url }}"{% if is_external %} target="_blank" rel="noopener noreferrer"{% endif %}>{{ include.post.title }}</a>
        {% else %}
        {{ include.post.title }}
        {% endif %}
      </h3>

      {% if include.post.description or include.post.content %}
      <p class="{{c}}__excerpt">
        {% if include.post.description %}
          {{ include.post.description }}
        {% else %}
          {{ include.post.content | strip_html | truncate: 160 }}
        {% endif %}
      </p>
      {% endif %}

      <div class="{{c}}__meta">
        <time class="{{c}}__date" datetime="{{ include.post.date | date_to_xmlschema }}">{{ include.post.date | date: "%b %d, %Y" }}</time>
        {% if target_url %}
        <span class="{{c}}__cta">{% if is_external %}View update{% else %}Read more{% endif %}</span>
        {% endif %}
      </div>
    </div>
  </div>
</article>
